<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>utils/Logger.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Conditions.Condition.html">Condition</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Conditions.Condition.html#getType">getType</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Conditions.IntervalCondition.html">IntervalCondition</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Conditions.IntervalCondition.html#getType">getType</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Conditions.ThresholdCondition.html">ThresholdCondition</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Conditions.ThresholdCondition.html#getType">getType</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Devices.Controller.html">Controller</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Devices.Device.html">Device</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Devices.Device.html#disable">disable</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Devices.Device.html#enable">enable</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Devices.Device.html#getStatus">getStatus</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Devices.Sensor.html">Sensor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Devices.Sensor.html#disable">disable</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Devices.Sensor.html#enable">enable</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Devices.Sensor.html#getData">getData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Devices.Sensor.html#getLatestData">getLatestData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Devices.Sensor.html#getStatus">getStatus</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Devices.Sensor.html#read">read</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Devices.Sensor.html#sample">sample</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Garden.Garden.html">Garden</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Garden.Garden.html#disable">disable</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Garden.Garden.html#enable">enable</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Garden.Garden.html#getDevice">getDevice</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Garden.Garden.html#getGardenStatus">getGardenStatus</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Garden.Garden.html#loadController">loadController</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Garden.Garden.html#loadSensor">loadSensor</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Garden.GardenEvent.html">GardenEvent</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Trigger.html">Trigger</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TriggerManager.html">TriggerManager</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Utils.Logger.html">Logger</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="View.html">View</a></span></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Grow-Controller.html">Grow-Controller</a></span></li><li class="nav-heading">Namespaces</li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="Devices.html">Devices</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="Garden.html">Garden</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="Triggers.html">Triggers</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Triggers.html#.createCondition">createCondition</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Triggers.html#.createInterval">createInterval</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#__gardendir">__gardendir</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#__gardenfile">__gardenfile</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#log">log</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">utils/Logger.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const util = require('util');
const fs = require('fs');
const path = require('path');



if(!String.prototype.findWithWildcards){
// eslint-disable-next-line no-extend-native
    String.prototype.findWithWildcards = function(needle){
        var escapeRegex = (str) => str.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1");
        return new RegExp("^" + needle.split("*").map(escapeRegex).join(".*") + "$").test(this);
    }
}
/** 
 * Creates Log Functions based on params, Levels create functions for each level, and write to different files, and streams
 * Env Params Accepted: GARDEN_ROOT_DIR = Project Path | DEBUG_SCOPES * is wildcard | DEBUG
 * @namespace Utils
 * @memberof Utils
 * @name Logger
 * @constructor
 * @param {Object} [options] - The options object
 * @param {Object} [options.levels = {error: 0, warn: 1, info: 2, debug: 3}] - The Different Levels eg. error, warn, info, debug
 * @param {Object} [options.files = { all: null, error: '/logs/error.log', warn: '/logs/warn.log', info: '/logs/info.log', debug: '/logs/debug.log' }] - The Debugging Files, options are based on levels with the added all null can be defined to disable a specific log file
 * @param {Object} [options.stoutOpts = { noDebug: ['error', 'warn'] }] - Options for the stdout control.
 * 
 * 
 *
 * 
*/
module.exports = function Logger({
    levels = {
        error: 0,
        warn: 1,
        info: 2,
        debug: 3
    },
    files = {
        all: null,
        error: '/logs/error.log',
        warn: '/logs/warn.log',
        info: '/logs/info.log',
        debug: '/logs/debug.log'
    },
    stoutOpts = {
        noDebug: ['error', 'warn']
    }
} = {}) {
    this.levels = levels
    this.files = {};
    this.stoutOpts = stoutOpts;
    this.stdout = process.stdout;
    this.stderr = process.stderr;


    var ENV = process.env;
    var targetLevels, scopes;
    if (ENV.hasOwnProperty('DEBUG') &amp;&amp; ENV.DEBUG) {
        targetLevels = stoutOpts.hasOwnProperty('debug') ? this.stoutOpts.debug.map(e => [e, true]) : [
            ['all', true]
        ];
        if (ENV.hasOwnProperty('DEBUG_SCOPES')) {
            scopes = ENV.DEBUG_SCOPES.toUpperCase();
            this.scopes = scopes.split(',');
            console.log(this.scopes);
        } else {
            this.scopes = ['*'];
        }
    } else {
        targetLevels = this.stoutOpts.noDebug.map(e => [e, true]);
    }

    this.stouts = Object.fromEntries(targetLevels);

    try {
        for (let file in files) {
            if (typeof files[file] === 'string') {
                let filepath = path.join(__gardendir, files[file]);
                console.log(filepath);
                try {
                    this.files[file] = fs.createWriteStream(filepath, {
                        flags: "a"
                    });
                } catch (err) {
                    console.error("Error Creating Log Files Streams:\n", err);
                }
            }
        }
    } catch (err) {
        console.error("Error Creating Log Files Streams:\n", err);
    }
    for (let level in levels) {
        this[level] = function (message, ...rest) {
            let formatScope = (scope) => {
                if (scope == '*') {
                    return "[All]";
                } else {
                    return `[${scope.toUpperCase()}]`;
                }
            }
            var log = (scope = '*', inspectOpts = {
                colors: true
            }) => {
                rest.unshift(message);
                rest.unshift(inspectOpts);
                let inspects = util.formatWithOptions.apply(null, rest);
                let out = `${formatScope(scope)}: ${inspects}`;
                if (this.files.hasOwnProperty('all')) this.files.all.write(out + "\n");
                if (this.files.hasOwnProperty(level)) this.files[level].write(out + "\n");

                if(scope !== '*'){
                    if(this.scopes.findIndex(e => scope.toUpperCase().findWithWildcards(e)) === -1){
                        return;
                    }
                }
                if (this.stouts.hasOwnProperty('all')) {
                    if (level === 'error') this.stderr.write(out + "\n");
                    else this.stdout.write(out + "\n");
                }
                if (this.stouts.hasOwnProperty(level)) {
                    if (level === 'error') this.stderr.write(out + "\n");
                    else this.stdout.write(out + "\n");
                }
            }
            return (scope = '*') => log(scope);
        }
    };
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Mon Nov 04 2019 18:28:19 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
